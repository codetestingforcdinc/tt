<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Daily Schedule</title>
<style>
:root{--bg:#0b0b0f;--card:#12121a;--accent:#7c7cff;--text:#eaeaf0}
*{box-sizing:border-box}
body{margin:0;min-height:100vh;background:radial-gradient(1200px 600px at 10% 0%,#111126,var(--bg));color:var(--text);font-family:Inter,system-ui;display:flex;justify-content:center;align-items:center}
.app{width:min(900px,95vw);background:linear-gradient(180deg,#141423,var(--card));border-radius:18px;padding:24px}
h1{margin:0;color:var(--accent)}
.list{margin-top:16px;display:flex;flex-direction:column;gap:12px}
.slot{background:rgba(0,0,0,.35);border-radius:14px;padding:14px;cursor:grab}
.slot.current{background:var(--accent);color:#0b0b14}
.time{font-size:.85rem;color:var(--accent);outline:none}
.slot.current .time{color:#0b0b14}
.todo{display:flex;gap:8px;margin-top:8px}
.todo input[type=text]{flex:1;background:transparent;border:none;border-bottom:1px dashed rgba(255,255,255,.3);color:inherit;outline:none}
footer{display:flex;justify-content:space-between;margin-top:18px}
button{background:linear-gradient(135deg,var(--accent),#a48bff);border:none;border-radius:10px;padding:8px 14px;font-weight:600;cursor:pointer}
</style>
</head>
<body>
<div class="app">
<h1>Daily Schedule</h1>
<div class="list" id="grid"></div>
<footer>
<button id="add">Add Slot</button>
<button id="clear">Reset</button>
</footer>
</div>
<script>
/* === STORAGE (FIXED) === */
const KEY='dailySchedule_v2';
const save=()=>localStorage.setItem(KEY,JSON.stringify(data));
const load=()=>JSON.parse(localStorage.getItem(KEY)||'[]');

/* === TIME UTILS === */
const parse=t=>{const m=t.match(/(\d{1,2}):(\d{2})/);return m?(+m[1]*60+ +m[2]):null};
const fmt=m=>String(Math.floor(m/60)%24).padStart(2,'0')+':'+String(m%60).padStart(2,'0');

/* === STATE === */
let data=load();
if(!data.length){data=[{start:360,dur:30,text:'',done:false,asked:false}]}
const grid=document.getElementById('grid');

function chain(){for(let i=1;i<data.length;i++)data[i].start=data[i-1].start+data[i-1].dur}

function render(){grid.innerHTML='';data.forEach((it,i)=>{
  const el=document.createElement('div');el.className='slot';el.draggable=true;
  const end=it.start+it.dur;
  el.innerHTML=`<div class=time contenteditable>${fmt(it.start)} – ${fmt(end)}</div>
  <div class=todo><input type=checkbox ${it.done?'checked':''}><input type=text value="${it.text}"></div>`;

  const time=el.querySelector('.time');
  const cb=el.querySelector('input[type=checkbox]');
  const txt=el.querySelector('input[type=text]');

  time.onblur=()=>{const p=time.textContent.split('–').map(x=>parse(x.trim()));if(p[0]!=null&&p[1]!=null){it.start=p[0];it.dur=Math.max(5,p[1]-p[0]);chain();save();render()}};
  cb.onchange=()=>{it.done=cb.checked;save();render()};
  txt.oninput=()=>{it.text=txt.value;save()};

  el.ondragstart=()=>drag=i;
  el.ondragover=e=>e.preventDefault();
  el.ondrop=()=>{[data[drag],data[i]]=[data[i],data[drag]];chain();save();render()};

  grid.appendChild(el);
});tick()}

let drag=null;

function tick(){const now=new Date();const cur=now.getHours()*60+now.getMinutes();
 document.querySelectorAll('.slot').forEach((el,i)=>{el.classList.remove('current');const it=data[i];if(cur>=it.start&&cur<it.start+it.dur)el.classList.add('current');if(cur>it.start+it.dur&&!it.done&&!it.asked){it.asked=true;if(confirm(`Completed: "${it.text||'this task'}"?`))it.done=true;save();render()}})}

add.onclick=()=>{const last=data[data.length-1];data.push({start:last.start+last.dur,dur:30,text:'',done:false,asked:false});save();render()};
clear.onclick=()=>{if(confirm('Clear all?')){data=[];save();render()}};

render();setInterval(tick,30000);
</script>
</body>
</html>
